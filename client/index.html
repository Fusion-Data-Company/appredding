<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover" />
    <meta name="description" content="apredding.net - Northern California's premier solar installation company. Expert solar panel repair, maintenance, and installation services with 25+ years of experience." />
    <meta name="keywords" content="solar installation, solar panels, solar repair, Northern California solar, NEM 3.0, solar maintenance, battery storage, solar energy" />
    <meta name="author" content="apredding.net Solar Solutions" />
    <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />
    
    <!-- Dynamic base URL for social media (set by script below) -->
    <meta name="twitter:card" content="summary_large_image" id="twitter-card" />
    <meta name="twitter:title" content="Advance Power Redding - Premier Solar Solutions" id="twitter-title" />
    <meta name="twitter:description" content="Northern California's trusted solar installation company. Expert solar panel repair, maintenance, and installation with 25+ years of experience and NEM 3.0 expertise." id="twitter-description" />
    <meta name="twitter:image" content="" id="twitter-image" />
    
    <!-- Open Graph (Facebook, LinkedIn, WhatsApp, etc.) -->
    <meta property="og:title" content="Advance Power Redding - Premier Solar Solutions" id="og-title" />
    <meta property="og:description" content="Northern California's trusted solar installation company. Expert solar panel repair, maintenance, and installation with 25+ years of experience and NEM 3.0 expertise." id="og-description" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="" id="og-url" />
    <meta property="og:image" content="" id="og-image" />
    <meta property="og:image:secure_url" content="" id="og-image-secure" />
    <meta property="og:image:alt" content="Advance Power Redding - Premier solar installation and repair services in Northern California" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Advance Power Redding" />
    
    <!-- Favicons for all platforms -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/jpeg" sizes="any" href="/advance-power-logo.jpg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    
    <!-- Set dynamic URLs based on current domain -->
    <script>
      (function() {
        const baseUrl = window.location.origin;
        const logoPath = '/advance-power-logo.jpg';
        const fullLogoUrl = baseUrl + logoPath;
        
        // Update Open Graph tags
        document.getElementById('og-url').setAttribute('content', baseUrl + '/');
        document.getElementById('og-image').setAttribute('content', fullLogoUrl);
        document.getElementById('og-image-secure').setAttribute('content', fullLogoUrl);
        
        // Update Twitter Card tags
        document.getElementById('twitter-image').setAttribute('content', fullLogoUrl);
      })();
    </script>
    
    <title>apredding.net | Premier Solar Solutions for Northern California</title>
    
    <!-- OPTIMIZED RESOURCE LOADING STRATEGY -->
    
    <!-- 1. PRECONNECT - Start DNS+TCP+TLS for critical domains (highest priority) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    
    <!-- 2. DNS PREFETCH - Resolve DNS for secondary domains -->
    <link rel="dns-prefetch" href="https://images.unsplash.com">
    <link rel="dns-prefetch" href="https://replit.com">
    
    <!-- 3. PRELOAD CRITICAL CSS - Blocking resources first -->
    <link rel="preload" as="style" href="/src/index.css" fetchpriority="high">
    <link rel="stylesheet" href="/src/index.css">
    
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" fetchpriority="high">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 4. PRELOAD CRITICAL JAVASCRIPT - Core modules only -->
    <link rel="modulepreload" href="/src/main.tsx" fetchpriority="high">
    <link rel="modulepreload" href="/src/App.tsx" fetchpriority="high">
    <link rel="modulepreload" href="/src/pages/Home.tsx" fetchpriority="high">
    
    <!-- 5. PRELOAD LCP IMAGE - Only the hero image for fastest LCP -->
    <link rel="preload" href="/src/assets_dir/images/optimized/new-praetorian-hero.png" as="image" 
          fetchpriority="high" imagesizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1200px" crossorigin="anonymous">
    
    <!-- Note: Video and secondary images removed from preload to reduce initial payload -->
    <!-- They will load on-demand using lazy loading and intersection observer -->
    
    <!-- Crucial metadata for improving video and image loading -->
    <meta http-equiv="Accept-CH" content="DPR, Width, Viewport-Width">
    <meta http-equiv="Cache-Control" content="max-age=86400, public, stale-while-revalidate=31536000">
    
    <!-- Critical page loading optimizations -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://*.elevenlabs.io https://*.elevenlabs.ai https://replit.com; connect-src 'self' https://unpkg.com https://*.elevenlabs.io https://*.elevenlabs.ai wss://*">
    
    <!-- Theme script disabled - using component-level dark backgrounds instead of global dark class -->
    <script>
      // Global dark class removed to allow bright gradient text in hero sections
      // Components use bg-black for dark backgrounds where needed
    </script>
  </head>
  <body>
    <!-- Add loading state class to help with transitions -->
    <div id="root" class="loading"></div>
    
    <!-- Critical JS chunk - minimal JS to bootstrap the app -->
    <script type="module" src="/src/main.tsx" defer></script>
    
    <!-- Critical CSS inlined -->
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: system-ui, -apple-system, sans-serif; background: white; color: #1f2937; }
      .loading { opacity: 0; }
      .hero { min-height: 50vh; display: flex; align-items: center; justify-content: center; }
      .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    </style>
    
    <!-- Enhanced Performance Monitoring Script -->
    <script>
      // Core Web Vitals and performance monitoring
      (function() {
        // Track when DOMContentLoaded fires
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            if (window.performance && window.performance.mark) {
              window.performance.mark('dom_content_loaded');
            }
          });
        }
        
        // Track when page is fully loaded
        window.addEventListener('load', () => {
          if (window.performance && window.performance.mark) {
            window.performance.mark('app_loaded');
            
            // Measure and report Core Web Vitals
            setTimeout(() => {
              const navigation = performance.getEntriesByType('navigation')[0];
              if (navigation) {
                const metrics = {
                  dns: navigation.domainLookupEnd - navigation.domainLookupStart,
                  tcp: navigation.connectEnd - navigation.connectStart,
                  request: navigation.responseStart - navigation.requestStart,
                  response: navigation.responseEnd - navigation.responseStart,
                  dom: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
                  load: navigation.loadEventEnd - navigation.loadEventStart,
                  total: navigation.loadEventEnd - navigation.fetchStart
                };
                
                // Only log in development
                if (window.location.hostname === 'localhost' || window.location.hostname.includes('replit')) {
                  console.log('⚡ Performance Metrics:', metrics);
                }
              }
            }, 0);
          }
          
          // Remove loading class after smooth transition
          setTimeout(() => {
            const root = document.getElementById('root');
            if (root) root.classList.remove('loading');
          }, 50);
        });
        
        // Track Largest Contentful Paint (LCP)
        if (window.PerformanceObserver) {
          try {
            const lcpObserver = new PerformanceObserver((list) => {
              const entries = list.getEntries();
              const lastEntry = entries[entries.length - 1];
              const lcp = lastEntry.renderTime || lastEntry.loadTime;
              
              if (lcp > 4000) {
                console.warn('⚠️ Slow LCP detected:', Math.round(lcp) + 'ms');
              }
              
              // Disconnect after first meaningful paint
              if (lcp > 0) lcpObserver.disconnect();
            });
            lcpObserver.observe({ type: 'largest-contentful-paint', buffered: true });
          } catch (e) {
            // LCP not supported
          }
          
          // Track Cumulative Layout Shift (CLS)
          try {
            let clsValue = 0;
            const clsObserver = new PerformanceObserver((list) => {
              for (const entry of list.getEntries()) {
                if (!entry.hadRecentInput) {
                  clsValue += entry.value;
                }
              }
              if (clsValue > 0.1) {
                console.warn('⚠️ Layout shift detected:', clsValue.toFixed(3));
              }
            });
            clsObserver.observe({ type: 'layout-shift', buffered: true });
            
            // Auto-disconnect after 10 seconds
            setTimeout(() => clsObserver.disconnect(), 10000);
          } catch (e) {
            // CLS not supported
          }
        }
        
        // Enhanced error handling for media elements
        window.addEventListener('error', (e) => {
          if (e.target && (e.target.tagName === 'VIDEO' || e.target.tagName === 'SOURCE')) {
            console.warn('Video element error detected, using fallback image:', e);
          }
          if (e.target && e.target.tagName === 'IMG') {
            console.warn('Image load error:', e.target.src);
          }
        }, true);
        
        // Track First Input Delay (FID) - user interaction responsiveness
        if (window.PerformanceObserver) {
          try {
            const fidObserver = new PerformanceObserver((list) => {
              const entries = list.getEntries();
              entries.forEach((entry) => {
                const fid = entry.processingStart ? entry.processingStart - entry.startTime : entry.duration;
                if (fid > 100) {
                  console.warn('⚠️ Slow first input:', Math.round(fid) + 'ms');
                }
              });
              fidObserver.disconnect();
            });
            fidObserver.observe({ type: 'first-input', buffered: true });
          } catch (e) {
            // FID not supported
          }
        }
      })();
    </script>
    
    <!-- Load non-critical scripts asynchronously -->
    <script src="https://replit.com/public/js/replit-dev-banner.js" async></script>
  </body>
</html>
